<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Scan2Order | Vendor Dashboard</title>

  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">

  <style>
    * {
      box-sizing: border-box;
      font-family: 'Inter', sans-serif;
    }

    body {
      margin: 0;
      background: #f4f6f8;
      padding: 20px;
    }

    .header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 20px;
    }

    .title {
      font-size: 22px;
      font-weight: 700;
    }

    .card {
      background: white;
      padding: 20px;
      border-radius: 14px;
      box-shadow: 0 8px 20px rgba(0,0,0,0.08);
      margin-bottom: 20px;
    }

    .qr {
      text-align: center;
    }

    img {
      margin-top: 15px;
      width: 220px;
    }

    button {
      padding: 10px 16px;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      font-weight: 600;
      background: #ff6f61;
      color: white;
    }
  </style>
</head>

<body>

  <div class="header">
    <div class="title">Vendor Dashboard</div>
    <button onclick="logout()">Logout</button>
    <button onclick="window.location.href='orders.html'">
  View Orders
</button>

  </div>
<div class="card">
  <h3>Shop Details</h3>

  <input id="shopName" placeholder="Shop Name" style="width:100%;padding:10px;border-radius:8px;border:1px solid #ccc;margin-bottom:10px;" />
  <input id="whatsapp" placeholder="WhatsApp Number" style="width:100%;padding:10px;border-radius:8px;border:1px solid #ccc;margin-bottom:10px;" />

  <button onclick="saveShop()">Save Shop</button>
</div>
<div class="card">
  <h3>Add Menu Item</h3>

  <input id="itemName" placeholder="Item Name"
    style="width:100%;padding:10px;border-radius:8px;border:1px solid #ccc;margin-bottom:10px;" />

  <input id="itemPrice" type="number" placeholder="Price"
    style="width:100%;padding:10px;border-radius:8px;border:1px solid #ccc;margin-bottom:10px;" />
  

  <button onclick="addItem()">Add Item</button>

  <div id="menuItems" style="margin-top:15px;"></div>
</div>

  <div class="card qr">
    <h3>Your Shop QR Code</h3>
    <p>Scan from another mobile to view menu</p>
    <img id="qrImage" />
  </div>

<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-app.js";
  import { getAuth, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-auth.js";
  import {
    getFirestore, doc, setDoc, getDoc
  } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore.js";
  
  const firebaseConfig = {
    apiKey: "AIzaSyA6vnk_Vf96qwLq0S3yMdChgxR9FsPNyzw",
    authDomain: "scan2order-df6bb.firebaseapp.com",
    projectId: "scan2order-df6bb",
    storageBucket: "scan2order-df6bb.firebasestorage.app",
    messagingSenderId: "422593854380",
    appId: "1:422593854380:web:b024c9ae30d64ca3a79809"
  };

  const app = initializeApp(firebaseConfig);
  const auth = getAuth(app);
  const db = getFirestore(app);
  

  let shopId = "";
  let menu = [];
  let editingItemId = null;

  onAuthStateChanged(auth, async (user) => {
    if (!user) {
      window.location.href = "index.html";
      return;
    }

    shopId = user.uid;

    // QR
    const menuURL = "https://naveenkumar-kpa.github.io/scan2order/menu.html?shopId=" + shopId;

    document.getElementById("qrImage").src =
      "https://api.qrserver.com/v1/create-qr-code/?size=300x300&data=" +
      encodeURIComponent(menuURL);

    // Load shop
    const shopSnap = await getDoc(doc(db, "shops", shopId));
    if (shopSnap.exists()) {
      document.getElementById("shopName").value = shopSnap.data().name || "";
      document.getElementById("whatsapp").value = shopSnap.data().whatsapp || "";
    }

    // Load menu
    const menuSnap = await getDoc(doc(db, "menus", shopId));
    if (menuSnap.exists()) {
      menu = menuSnap.data().items || [];
      renderMenu();
    }
  });

  window.saveShop = async () => {
    await setDoc(doc(db, "shops", shopId), {
      name: document.getElementById("shopName").value,
      whatsapp: document.getElementById("whatsapp").value
    });
    alert("Shop saved ‚úÖ");
  };

  window.addItem = async () => {
  const name = itemName.value;
  const price = Number(itemPrice.value);

  if (!name || !price) {
    alert("Enter item name and price");
    return;
  }

  // üü° EDIT MODE
  if (editingItemId) {
    const item = menu.find(i => i.id === editingItemId);
    if (item) {
      item.name = name;
      item.price = price;
    }
    editingItemId = null;
  }
  // üü¢ ADD MODE
  else {
    menu.push({
      id: Date.now().toString(),
      name,
      price
    });
  }

  await setDoc(doc(db, "menus", shopId), {
    items: menu
  });

  // Clear inputs
  itemName.value = "";
  itemPrice.value = "";

  renderMenu();
};




  function renderMenu() {
  menuItems.innerHTML = "";

  menu.forEach(item => {
    menuItems.innerHTML += `
      <div style="margin-bottom:10px;">
        <b>${item.name}</b> - ‚Çπ${item.price}
        <button onclick="startEdit('${item.id}')">‚úèÔ∏è</button>
        <button onclick="deleteItem('${item.id}')">‚ùå</button>
      </div>
    `;
  });
}
window.startEdit = (id) => {
  const item = menu.find(i => i.id === id);
  if (!item) return;

  // Fill inputs
  itemName.value = item.name;
  itemPrice.value = item.price;

  // Set edit mode
  editingItemId = id;
};


window.deleteItem = async (id) => {
  menu = menu.filter(item => item.id !== id);

  await setDoc(doc(db, "menus", shopId), {
    items: menu
  });

  renderMenu();
};


  window.logout = () => signOut(auth);
</script>



</body>
</html>

